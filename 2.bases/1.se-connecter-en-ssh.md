# SSH 

Avant d’utiliser Ansible, il faut comprendre comment établir une connexion SSH à une machine distante. Ici, nous allons utiliser un container Docker comme cible de test.

## 1. Se connecter au container ansible-test

### 1.1 Créer le container ansible-test

Image Ubuntu avec SSH déjà configuré, login par défaut : root / root

```bash
docker run -d \
  --name ansible-test \
  -p 2222:22 \
  rastasheep/ubuntu-sshd:18.04
```

1. docker run : créé et démarre un nouveau container à partir d'une image
2. -d : detached mode, exécution en arrière-plan
3. --name ansible-test : donne le nom explicite du container
4. -p 2222:22 : Mapping de port port-hôte:port-container
5. rastasheep/ubuntu-sshd:18.04: Nom de l'image docker

### 1.2 Se connecter à ansible-test via SSH 

```bash
ssh root@127.0.0.1 -p 2222 
```

1. ssh : ouvre une session sécurisée vers un hôte distant.
2. "root@127.0.0.1" : root est le nom de l'utilisateur suivi de l'adresse de loopback 127.0.0.1
3. -p 2222 : Indique à SSH de se connecter sur le port 2222 au lieu du port SSH standard (22)

## 2. Se connecter sans devoir retenir le mdp de ROOT

### 2.1 Générer une clé SSH 

```bash
ssh-keygen -t ed25519 -f ~/.ssh/ansible-test -N ""
 ```

1. ssh-keygen : Outil qui sert à générer une paire de clés SSH
2. -t ed25519 : Type d’algorithme pour la clé. ed25519 est un algorithme moderne, rapide et sécurisé.
3. -f ~/.ssh/ansible-test : chemin et nom de fichier où sera stockée la clé privée.
4. -N "" : mot de passe qui protège la clé privée.

### 2.2 Copier la clé publique sur le container ansible-test

```bash
ssh-copy-id -i ~/.ssh/ansible-test.pub -p 2222 root@127.0.0.1
```
1. ssh-copy-id : Script qui copie ta clé publique SSH dans le fichier ~/.ssh/authorized_keys du serveur distant.
2. -i ~/.ssh/ansible-test.pub : Spécifie le chemin de ta clé publique à envoyer.
3. -p 2222 : Indique à SSH de se connecter sur le port 2222 au lieu du port SSH standard (22)
4. "root@127.0.0.1" : root est le nom de l'utilisateur suivi de l'adresse de loopback 127.0.0.1
