# D√©mo ‚Äì Premier Playbook

Maintenant que nous savons nous connecter en SSH, voyons comment **Ansible peut ex√©cuter une t√¢che simple** sur notre container `ansible-test`.

## 0. Etape pr√©liminaire 

Lancer le docker-compose disponible dans ./setup_servers_for_demo_ansible
Le User et le Mot de passe SSH sont identique et est `demo`. 
Cet Uset est un sudoers et aura donc des privil√®ges root.

Voici la commande pour copier votre cl√© publique `ssh-copy-id -i ~/.ssh/ansible-test.pub -p 2222 demo@127.0.0.1`

## 1. Pr√©parer un inventaire minimal

Fichier : `inventory.ini`

```ini
[demo]
127.0.0.1 ansible_port=2222 ansible_user=demo ansible_ssh_private_key_file=~/.ssh/ansible-test
```

- [demo] : nom du groupe de machines (ici, juste notre container).
- 127.0.0.1 : adresse de la machine.
- ansible_port=2222 : car nous avons mapp√© le port 2222.
- ansible_user=demo : utilisateur du container.
- ansible_ssh_private_key_file=... : chemin de la cl√© g√©n√©r√©e pr√©c√©demment.

## 2. Cr√©er un playbook minimal 

Fichier : `install-nginx.yml`

```yml
- name: Installer et d√©marrer Nginx
  hosts: demo
  tasks:
    - name: Installer le paquet nginx
      apt:
        name: nginx
        state: present
      become: yes

    - name: S‚Äôassurer que le service est d√©marr√©
      service:
        name: nginx
        state: started
```

- hosts: demo : fait r√©f√©rence au groupe d√©fini dans l‚Äôinventaire.
- tasks : liste des actions.
- apt : module Ansible qui installe un paquet Debian/Ubuntu.
- service : module qui g√®re l‚Äô√©tat d‚Äôun service (start/stop/restart).

## 3. Ex√©cuter le playbook 

```bash
ansible-playbook -i inventory.ini install-nginx.yml
```

- -i inventory.ini : indique le fichier inventaire.
- install-nginx.yml : nom du playbook.

## 4. R√©sultat attendu 

- Ansible se connecte en SSH √† `127.0.0.1:2222`.
- Il installe nginx dans le container.
- Il d√©marre le service nginx.
- Et si tu relances la m√™me commande ‚ûù aucune action suppl√©mentaire (idempotence).

üëâ En ouvrant un navigateur aller sur `http://127.0.0.1:8080` pour voir la page par d√©faut de Nginx.
